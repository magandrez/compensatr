<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Compensatr</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.2/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.2/favicon_yellow.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.2/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2020-01-08T21:05:20+02:00">2020-01-08T21:05:20+02:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="yellow">81.44%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         14.69
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>5</b> files in total.
    <b>264</b> relevant lines. 
    <span class="green"><b>215</b> lines covered</span> and
    <span class="red"><b>49</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#2b870551e7a85684068ae764359038150ff5ae31" class="src_link" title="compensatr.rb">compensatr.rb</a></td>
        <td class="red strong">69.59 %</td>
        <td>381</td>
        <td>148</td>
        <td>103</td>
        <td>45</td>
        <td>10.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7ac088f5f1fc78a8e2737757a7b89dff51d5747e" class="src_link" title="lib/data_validator.rb">lib/data_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>49</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>48.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2eda4966983291c78c6f4be5bfd444ff117d7983" class="src_link" title="lib/file_handler.rb">lib/file_handler.rb</a></td>
        <td class="green strong">95.65 %</td>
        <td>60</td>
        <td>23</td>
        <td>22</td>
        <td>1</td>
        <td>13.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7e6b43ea560dce5bc3afb81229bd69374c240ac3" class="src_link" title="lib/input_parser.rb">lib/input_parser.rb</a></td>
        <td class="green strong">95.59 %</td>
        <td>153</td>
        <td>68</td>
        <td>65</td>
        <td>3</td>
        <td>19.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3b456ba687bbb33b0ed70ac458fbf851141cd244" class="src_link" title="lib/output.rb">lib/output.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>50</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.17.1 
        and simplecov-html v0.10.2<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="2b870551e7a85684068ae764359038150ff5ae31">
  <div class="header">
    <h3>compensatr.rb</h3>
    <h4><span class="red">69.59 %</span> covered</h4>
    <div>
      <b>148</b> relevant lines. 
      <span class="green"><b>103</b> lines covered</span> and
      <span class="red"><b>45</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># frozen_string_literal: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require_relative &#39;lib/input_parser&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require_relative &#39;lib/file_handler&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require_relative &#39;lib/data_validator&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">require_relative &#39;lib/output&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;set&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;date&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"># Class that implements algorithm to find a suitable selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"># of projects that meet input criteria. The algorithm</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"># iterates a large amount of times finding out the best selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"># given the restrictions.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">class Compensatr</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  include DataValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  include Output</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  MAX_ITERATIONS = 200_000</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # Entrypoint for script. Receives ARGV from</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # console, parses them and quicks in the search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # for a combination of projects that fit crteria</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # maximising output and minimising cost.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def run</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # Register input and enrich data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    parser = InputParser.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    params = parser.parse(ARGV)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    LOGGER.level = Logger::DEBUG if params.debug</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    file_handler = FileHandler.new(params.file, params.target)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    arr = file_handler.read_data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    raise StandardError, &quot;No projects to work on. Exiting&quot; if arr.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    projects = DataValidator.normalise_time(arr)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    raise StandardError, &quot;Error normalising time in keys hash.&quot; if projects.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    enriched_projects = calculate_efficiency(projects)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    # Use brute force to create an optimal selection</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    selection, value, money_spent = main_loop(enriched_projects, params)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    LOGGER.info(Output.selection_output(selection,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">                                        value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                                        money_spent,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">                                        params.money))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # At this point, a best selection is reached</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    # A &quot;correction round&quot; could be implemented</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    # to fill in the remaining value.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    # This is left as improvement similarly as the main loop</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    # TODO Implement correction round</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    purchase_plan = generate_purchase_plan(selection)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">    co2_report = generate_co2_report(selection, params.target_years)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    results = {</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      &#39;purchase_plan&#39; =&gt; purchase_plan,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      &#39;co2_report&#39; =&gt; co2_report</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    file_handler.write_data(results)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  # Brute forces a selection of projects by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  # trial-and-error, saving the most efficient combination</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  # between loops and doing constraint checks to validate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  # the selection of projects achieved in each iteration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  # @param [Array] projects source for the selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  # @param [InputParser] params input by the user with defaults</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def main_loop(projects, params)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    best_selection = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    money_spent = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    best_value = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">    1.upto(MAX_ITERATIONS) do |_i|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">      money = params.money</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">      total_value = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">      selection = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      # Achieve a selection</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">      loop do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">        pick = projects.sample</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">        break if (money - pick[:price]).negative?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">        money -= pick[:price]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">        selection.append(pick)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">        total_value += pick[:yearly_co2_vol]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      # Verify the selection is valid or move onto the next iteration</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">      next unless valid_project_constraints(selection)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">      next unless valid_min_continents(selection, params.continents)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">      next unless valid_min_groups(selection, params.groups)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      # Is it the best?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">      next unless total_value &gt; best_value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      # If it is better than previous selection, save it</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">      best_selection = selection.dup</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">      best_value = total_value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">      money_spent = params.money - money</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">      LOGGER.debug(Output.new_best_output(best_value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">                                          money_spent,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">                                          count_continents(best_selection)))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">      expenditures = add_costs(best_selection)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">      LOGGER.debug(Output.group_representation_output(expenditures,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">                                                      money_spent))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">    [best_selection, best_value, money_spent]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  # Enriches arr with efficiency (CO2/year)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  # @param [Array] arr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  # @return [Array] arr with efficiency per project</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">  def calculate_efficiency(arr)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="108">
          <span class="hits">8</span>
          
          <code class="ruby">    arr.map do |proj|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="109">
          <span class="hits">15</span>
          
          <code class="ruby">      proj[:yearly_co2_vol] = (proj[:co2_volume].to_f /</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">        proj[:std_time]).round(4)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="113">
          <span class="hits">8</span>
          
          <code class="ruby">    arr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  # Validates minimum units for selected project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  # It is valid if there is no minimum specified</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">  # @param [Integer] count of project in selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  # @param [Hash] proj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  # @return [TrueClass, FalseClass] true if project is within min boundaries</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">  def meets_min_units(count, proj)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="123">
          <span class="hits">5</span>
          
          <code class="ruby">    return true if proj[:min_units].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="125">
          <span class="hits">4</span>
          
          <code class="ruby">    (count &gt;= proj[:min_units])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  # Validates maximum units for selected project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  # @param [Integer] count of project in selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  # @param [Hash] proj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">  # @return [TrueClass, FalseClass] true if project is within max boundaries</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">  def meets_max_units(count, proj)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="133">
          <span class="hits">4</span>
          
          <code class="ruby">    return true if proj[:max_units].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="135">
          <span class="hits">3</span>
          
          <code class="ruby">    (count &lt;= proj[:max_units])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  # Each project repetition in the selection array means 1 credit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  # valid_project_constraints validates that the minimum and maximum</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">  # units per project are met</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  # @param [Array] selection of projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  # @return [TrueClass, FalseClass] true if valid, false otherwise</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_project_constraints(selection)</code>
        </li>
      
        <li class="covered" data-hits="1011" data-linenumber="145">
          <span class="hits">1011</span>
          
          <code class="ruby">    reps = selection.each_with_object(Hash.new(0)) { |h1, h2| h2[h1[:id]] += 1 }</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="146">
          <span class="hits">4</span>
          
          <code class="ruby">    req_reps = selection.all? do |proj|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="147">
          <span class="hits">6</span>
          
          <code class="ruby">      count = reps[proj[:id]]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="148">
          <span class="hits">6</span>
          
          <code class="ruby">      unless meets_min_units(count, proj) &amp;&amp; meets_max_units(count, proj)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="149">
          <span class="hits">3</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="152">
          <span class="hits">3</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">    req_reps</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">  # Counts the distribution of selected projects per continent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">  # Does not count &#39;nil&#39; values for continent key in project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">  # @TODO validate continent input</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  # @param [Array] projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  # @return [Integer]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">  def count_continents(projects)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="165">
          <span class="hits">7</span>
          
          <code class="ruby">    projects.map do |h|</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="166">
          <span class="hits">116</span>
          
          <code class="ruby">      h[:continent]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    end.compact.uniq.size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  # Verifies that the distribution of projects per continent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">  # falls within the minimum number of continents required by input</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  # @param [Array] selection of projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  # @param [Integer] minimum continents</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  # @return [TrueClass, FalseClass] true if it meets the minimum,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">  #   false otherwise</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_min_continents(selection, min_continents)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="177">
          <span class="hits">4</span>
          
          <code class="ruby">    count_continents(selection) &gt;= min_continents</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">  # Adds cost of projects in selection by group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">  # @TODO Validate group tags,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  # for now if not exact match nothing is added</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">  # @param [Array] projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">  # @return [Float]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">  def sum_prices_for_group(projects, term)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="187">
          <span class="hits">11</span>
          
          <code class="ruby">    projects.map do |proj|</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="188">
          <span class="hits">34</span>
          
          <code class="ruby">      proj[:price].to_f if proj[:group] == term</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">    end.compact.reduce(:+)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  # Summarises the costs of purchasing credits per</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">  # type of project returning a hash with prices</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">  # @param [Array] projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">  # @return [Hash] containing added costs per project group</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">  def add_costs(projects)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="198">
          <span class="hits">4</span>
          
          <code class="ruby">    { short: sum_prices_for_group(projects, &#39;short_term&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">      medium: sum_prices_for_group(projects, &#39;medium_term&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">      long: sum_prices_for_group(projects, &#39;long_term&#39;) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">  # Verifies the distribution of money per project group is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">  # within the minimum required per group.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">  # It is not valid if no value is provided and minimum required is above 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">  # It is valid if there is no minimum.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  # @param [Float, nilClass] value spent in specific project groups</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">  #   value might be nil (lack of projects in said group).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  # @param [Float] expenditure total money spent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">  # @param [Float] min money required to be spent per group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  # @return [TrueClass, FalseClass] true if the value spent is above the minimum</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">  def money_distribution(value, expenditure, min)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="214">
          <span class="hits">14</span>
          
          <code class="ruby">    return false if value.nil? &amp;&amp; min.to_f.positive?</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="215">
          <span class="hits">13</span>
          
          <code class="ruby">    return true if min.to_f.zero? # cast to float converts nils to 0.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="217">
          <span class="hits">8</span>
          
          <code class="ruby">    (value.to_f &gt;= expenditure.to_f * (min.to_f / 100))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">  # Aggregates the validations of money distribution per group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">  # @param [Hash] sums money per project group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">  # @param [Float] total_money spent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">  # @param [Hash] groups containing min percentage of money to be spent in group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">  # @return [Hash] containing summary of validations per project group</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_min_expenditures(sums, total_money, groups)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="227">
          <span class="hits">4</span>
          
          <code class="ruby">    { short: money_distribution(sums[:short],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                                total_money,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">                                groups[:min_short_term_percent]),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">      medium: money_distribution(sums[:medium],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">                                 total_money,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">                                 groups[:min_medium_term_percent]),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">      long: money_distribution(sums[:long],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">                               total_money,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">                               groups[:min_long_term_percent]) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">  # Regenerates groups mapping with integers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">  # for comparing sets of project groups</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">  # Leaves out from the map requirements without min expenditure.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">  # @param [Hash] groups hash stating minimum percentages of expenditure</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">  # @return [Hash] groups of expenditures by integer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">  def remap_groups(groups)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="245">
          <span class="hits">12</span>
          
          <code class="ruby">    groups.reject! { |_k, v| v.zero? }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="246">
          <span class="hits">3</span>
          
          <code class="ruby">    key_map = { min_short_term_percent: 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">                min_medium_term_percent: 1,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                min_long_term_percent: 2 }</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="249">
          <span class="hits">8</span>
          
          <code class="ruby">    groups.transform_keys { |k| key_map[k] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">  # Applies all combinations of possible minimum percentages registered</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">  # at input time. Comparing arrays in Ruby is not possible with &#39;==&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">  # but Set class provides such functionality, hence the casts &lt;Array&gt;.to_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">  # Does so by mapping the inputs (mapped in integers)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">  # @param [Array] selection of projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">  # @param [Hash] groups specifying minimal expenditure per group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">  # @return [TrueClass, FalseClass] true if the selection is representative</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">  #         to the minimum required by input</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_min_groups(selection, groups)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">    # If no minimums apply, selection is valid</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="263">
          <span class="hits">2</span>
          
          <code class="ruby">    return true if groups.values.all?(&amp;:zero?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">    summary = add_costs(selection)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">    # remove possible nils from add_costs and calculate money spent in selection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">    money_spent = summary.values.compact.reduce(:+)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">    valid = validate_min_expenditures(summary, money_spent, groups)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">    groups = remap_groups(groups) # In order to compare sets of integers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">    if groups.keys.to_set == [0].to_set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="271">
          
          
          <code class="ruby">      valid[:short]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif groups.keys.to_set == [1].to_set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="273">
          
          
          <code class="ruby">      valid[:medium]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif groups.keys.to_set == [2].to_set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="275">
          
          
          <code class="ruby">      valid[:long]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif groups.keys.to_set == [0, 1].to_set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="277">
          
          
          <code class="ruby">      valid[:short] &amp;&amp; valid[:medium]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif groups.keys.to_set == [0, 2].to_set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="279">
          
          
          <code class="ruby">      valid[:short] &amp;&amp; valid[:long]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif groups.keys.to_set == [1, 2].to_set</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">      valid[:medium] &amp;&amp; valid[:long]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif groups.keys.to_set == [0, 1, 2].to_set</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">      valid[:short] &amp;&amp; valid[:medium] &amp;&amp; valid[:long]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">  # Agregates projects per project id and adds totals</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">  # @param [Array] selection of projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">  # @return [Array] aggregated selection of projects per project id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">  def aggregate(selection)</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="292">
          <span class="hits">17</span>
          
          <code class="ruby">    groups = selection.group_by { |h| h[:id] }</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="293">
          <span class="hits">6</span>
          
          <code class="ruby">    groups.map do |k, v|</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="294">
          <span class="hits">7</span>
          
          <code class="ruby">      agg_hash = v.first</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="295">
          <span class="hits">7</span>
          
          <code class="ruby">      agg_hash[:count] = v.count</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="296">
          <span class="hits">7</span>
          
          <code class="ruby">      agg_hash[:total_co2_captured] = v.first[:yearly_co2_vol] * v.count</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="297">
          <span class="hits">7</span>
          
          <code class="ruby">      agg_hash[:finished] = false # A project is finished when std_time is &lt; 0.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="299">
          <span class="hits">7</span>
          
          <code class="ruby">      groups[k] = agg_hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">  # Based on the best selection, creates a hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">  # containing the units purchased, the project id and</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">  # the total price for the operation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby">  # @param [Array] selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">  # @return [Array] array of hashes containing purchase plan</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">  def generate_purchase_plan(selection)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="310">
          <span class="hits">3</span>
          
          <code class="ruby">    if selection.empty?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">      LOGGER.info(&#39;No selection reached. Returning empty plan.&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">      return [{}]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="314">
          <span class="hits">2</span>
          
          <code class="ruby">    aggregated_projects = aggregate(selection)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="315">
          <span class="hits">2</span>
          
          <code class="ruby">    aggregated_projects.map do |proj|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="316">
          <span class="hits">2</span>
          
          <code class="ruby">      { &#39;project_id&#39; =&gt; proj[:id],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">        &#39;num_units&#39; =&gt; proj[:count],</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="318">
          <span class="hits">2</span>
          
          <code class="ruby">        &#39;price&#39; =&gt; (proj[:price] * proj[:count]).round(1) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">  # Calculates the years for which the script needs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">  # to calculate the report.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">  # @param [Integer] years. Min is 1 by default</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">  # @return [Array] array of years for which to generate the CO2 report</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">  #    or empty array if no years specified.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">  def years_to_report(years)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="329">
          <span class="hits">6</span>
          
          <code class="ruby">    unless years &amp;&amp; years &gt;= 1</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="330">
          <span class="hits">3</span>
          
          <code class="ruby">      LOGGER.error &#39;Report length not specified.&#39;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="331">
          <span class="hits">3</span>
          
          <code class="ruby">      return []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="333">
          <span class="hits">3</span>
          
          <code class="ruby">    this_yr = Date.today.year</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="334">
          <span class="hits">3</span>
          
          <code class="ruby">    final_yr = this_yr + (years - 1)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="335">
          <span class="hits">3</span>
          
          <code class="ruby">    (this_yr..final_yr).to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby">  # Based on the best selection, creates a CO2 report</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">  # for each of the years requested at input.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">  # NOTE: Opinionated implementation ahead</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">  # Each turning year might be projects that are not active anymore</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">  # since its &quot;time&quot; field is a constant given as part of the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">  # input data. This implementation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">  # *does not count* &#39;expired projects&#39; to generate the CO2 report</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">  # after &quot;time&quot; has passed when accumulating data creating the report.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">  # &quot;std_time&quot; per project is minused for this reason, to select</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">  # those projects that are active year after year based on user input.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">  # A negative std_time means the project &quot;has finished&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">  # thus: its &quot;potential CO2 captured&quot; is not counted.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">  # This becomes apparent as the CO2 captured total is skewed towards</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">  # the present year (i.e.: the closest to &quot;today&quot; the larger the CO2 captured).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">  # @param [Array] selection of most suitable projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">  # @param [Integer] years for which to calculate the CO2 captured</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">  # @return [Array] array of hashes containing CO2 captured per year.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">  def generate_co2_report(selection, years)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="359">
          <span class="hits">3</span>
          
          <code class="ruby">    if selection.empty?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">      LOGGER.info(&#39;No selection reached. Returning empty report.&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">      return [{}]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="363">
          <span class="hits">2</span>
          
          <code class="ruby">    report_length = years_to_report(years)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="364">
          <span class="hits">2</span>
          
          <code class="ruby">    return [{}] if report_length.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">    aggregated_projects = aggregate(selection)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">    co2_report = report_length.map do |year|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="368">
          <span class="hits">2</span>
          
          <code class="ruby">      aggregated_projects.reject! { |proj| proj[:finished] }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">      co2_counter = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_projects.each do |proj|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">        co2_counter += proj[:total_co2_captured]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">        proj[:std_time] -= 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">        proj[:finished] = true if proj[:std_time].negative?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">      { &#39;year&#39; =&gt; year,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">        &#39;co2_captured&#39; =&gt; co2_counter.round(1) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">    co2_report</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7ac088f5f1fc78a8e2737757a7b89dff51d5747e">
  <div class="header">
    <h3>lib/data_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># frozen_string_literal: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Module to validate source data to a minimal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"># extend.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module DataValidator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  TIME_MAP = {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    &#39;year&#39; =&gt; 1,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    &#39;month&#39; =&gt; 12,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    &#39;day&#39; =&gt; 365</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  }.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # Returns an array of projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # with normalised time per project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # @param [Array] arr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # @return [Array] arr with std_time per project if all OK</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.normalise_time(arr)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="17">
          <span class="hits">33</span>
          
          <code class="ruby">    invalid = invalid_time_units(arr)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="18">
          <span class="hits">33</span>
          
          <code class="ruby">    unless invalid.empty?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      LOGGER.error &quot;Time units are not recognised \</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">for projects with id: #{invalid.map { |r| r[:id] }}. Exiting.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    # Injects std_time field in each project hash with time in years.</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="25">
          <span class="hits">32</span>
          
          <code class="ruby">    arr.map do |proj|</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="26">
          <span class="hits">96</span>
          
          <code class="ruby">      proj[:std_time] = (proj[:time].to_f / TIME_MAP[proj[:time_unit]]).round(4)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    arr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # Returns an array of projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  # which time unit is not recognised.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # Generates regular expressions from the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # standardised time units, matches it against</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  # each of the projects&#39; time_unit returning</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # deviations.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # It is not the main task of this proof-of-concept</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # to provide a robust validation. For that, look</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  # into implementing something like dry-validation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # https://dry-rb.org/gems/dry-validation/1.4/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  # @param [Array] projects to validate time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  # @return [Array] projects with unrecognisable time units</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.invalid_time_units(projects)</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="44">
          <span class="hits">35</span>
          
          <code class="ruby">    units = TIME_MAP.keys</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="45">
          <span class="hits">35</span>
          
          <code class="ruby">    projects.reject do |pr|</code>
        </li>
      
        <li class="covered" data-hits="420" data-linenumber="46">
          <span class="hits">420</span>
          
          <code class="ruby">      units.select { |k| pr[:time_unit].match(k) }.any?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2eda4966983291c78c6f4be5bfd444ff117d7983">
  <div class="header">
    <h3>lib/file_handler.rb</h3>
    <h4><span class="green">95.65 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>22</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># frozen_string_literal: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;json&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"># Handles data serialization from source file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># and to target file.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">class FileHandler</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(src, target)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="9">
          <span class="hits">36</span>
          
          <code class="ruby">    @src_file = src</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="10">
          <span class="hits">36</span>
          
          <code class="ruby">    @target_file = target</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # Reads source file requested by user via $stdin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # @returns [Array] string of data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # @raise [SystemCallError] if there is an error reading input file</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def read_data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="18">
          <span class="hits">33</span>
          
          <code class="ruby">      str = File.read(@src_file)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    rescue SystemCallError =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      LOGGER.error &quot;Error reading file. #{e.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="23">
          <span class="hits">33</span>
          
          <code class="ruby">    return nil unless str</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="25">
          <span class="hits">32</span>
          
          <code class="ruby">    parse_input(str)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # Parses JSON input string into Ruby objects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # @param [String] src string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # @return [Array, nilClass] Ruby array with src projects or nil if error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_input(src)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="32">
          <span class="hits">34</span>
          
          <code class="ruby">    return nil unless valid_json?(src)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="34">
          <span class="hits">33</span>
          
          <code class="ruby">    JSON.parse(src, symbolize_names: true) if valid_json?(src)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # Validates JSON string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # @param [String] string to be parsed to JSON</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  # @raise [JSON::ParserError] if string is not valid JSON</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_json?(string)</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="41">
          <span class="hits">67</span>
          
          <code class="ruby">    !!JSON.parse(string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  rescue JSON::ParserError =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    LOGGER.error &quot;Error parsing data. #{e.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  # Writes data into a file set at input</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  # @param [Array] data source with purchase plan and CO2 report</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def write_data(data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      File.open(@target_file, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        f.write(JSON.dump(data))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    rescue SystemCallError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">      LOGGER.error &quot;Error writting file. #{e.inspect}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    LOGGER.info &quot;Report written to #{@target_file}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7e6b43ea560dce5bc3afb81229bd69374c240ac3">
  <div class="header">
    <h3>lib/input_parser.rb</h3>
    <h4><span class="green">95.59 %</span> covered</h4>
    <div>
      <b>68</b> relevant lines. 
      <span class="green"><b>65</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># frozen_string_literal: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;optparse&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"># Class in charge of reading and parsing input</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">class InputParser</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :parser, :options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # Class describing flags and options for script input</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  class ScriptOptions</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :target_years, :min_short_term_percent,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">                  :min_medium_term_percent, :min_long_term_percent, :target,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">                  :file, :money, :groups, :continents, :debug</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      # Defaults could be extracted to a file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # and read from there using</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      # e.g.; https://github.com/bkeepers/dotenv</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="19">
          <span class="hits">34</span>
          
          <code class="ruby">      self.target_years = 1</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="20">
          <span class="hits">34</span>
          
          <code class="ruby">      self.min_short_term_percent = 0.0</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="21">
          <span class="hits">34</span>
          
          <code class="ruby">      self.min_medium_term_percent = 0.0</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="22">
          <span class="hits">34</span>
          
          <code class="ruby">      self.min_long_term_percent = 0.0</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="23">
          <span class="hits">34</span>
          
          <code class="ruby">      self.target = &#39;./data/output.json&#39;</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="24">
          <span class="hits">34</span>
          
          <code class="ruby">      self.continents = 1</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="25">
          <span class="hits">34</span>
          
          <code class="ruby">      self.debug = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def file_to_parse(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="29">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;-f &lt;path&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">                &#39;--file &lt;path&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">                String,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">                &#39;Source file of projects&#39;) do |f|</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="33">
          <span class="hits">33</span>
          
          <code class="ruby">        self.file = f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    def target_to_serialise(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="38">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;-t &lt;path&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">                &#39;--target &lt;path&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                String,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">                &quot;Target file where result is stored. \</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">Defaults to ./data/output.json&quot;) do |t|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        self.target = t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def money_to_use(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="48">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;-m &lt;value&gt;&#39;, &#39;--money &lt;value&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">                Float,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">                &#39;Amount of money to be used&#39;) do |m|</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="51">
          <span class="hits">33</span>
          
          <code class="ruby">        self.money = m</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def years_to_report(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="56">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;--target_years &lt;value&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">                Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">                &#39;Target years for C02 optimization, defaults to 1&#39;) do |y|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">        self.target_years = y</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    def min_continents(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="64">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;--min_continents &lt;value&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">                Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">                &quot;Minimum number of continents where projects should be \</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">distributed, defaults to 1&quot;) do |con|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">        self.continents = con</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    def min_short_group(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="73">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;--min_short_term_percent &lt;value&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">                Float,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">                &quot;Minimum percentage of short term projects to be bought\</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">, defaults to 0&quot;) do |s|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">        self.min_short_term_percent = s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    def min_medium_group(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="82">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;--min_medium_term_percent &lt;value&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">                Float,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                &quot;Minimum percentage of medium term projects to be bought\</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">, defaults to 0&quot;) do |m|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">        self.min_medium_term_percent = m</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    def min_long_group(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="91">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;--min_long_term_percent &lt;value&gt;&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                Float,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                &quot;Minimum percentage of long term projects to be bought\</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">, defaults to 0&quot;) do |l|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">        self.min_long_term_percent = l</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">    def debug_flag(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="100">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on(&#39;-v&#39;, &#39;--[no-]verbose&#39;, &#39;Run verbosely&#39;) do |v|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">        self.debug = v</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">    def define_options(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="106">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.banner = &#39;Usage: compensatr.rb -f &lt;path&gt; -m &lt;value&gt; [options]&#39;</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="107">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.separator &#39;Options:&#39;</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="108">
          <span class="hits">34</span>
          
          <code class="ruby">      file_to_parse(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="109">
          <span class="hits">34</span>
          
          <code class="ruby">      target_to_serialise(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="110">
          <span class="hits">34</span>
          
          <code class="ruby">      money_to_use(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="111">
          <span class="hits">34</span>
          
          <code class="ruby">      years_to_report(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="112">
          <span class="hits">34</span>
          
          <code class="ruby">      min_continents(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="113">
          <span class="hits">34</span>
          
          <code class="ruby">      min_short_group(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="114">
          <span class="hits">34</span>
          
          <code class="ruby">      min_medium_group(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="115">
          <span class="hits">34</span>
          
          <code class="ruby">      min_long_group(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="116">
          <span class="hits">34</span>
          
          <code class="ruby">      debug_flag(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="117">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.on_tail(&#39;-h&#39;, &#39;--help&#39;, &#39;Show options&#39;) do |_h|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">        puts parser</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">        exit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">  # Reads input into options for the script to use</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  # @return [Hash] options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse(args)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="127">
          <span class="hits">34</span>
          
          <code class="ruby">    @options = ScriptOptions.new</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="128">
          <span class="hits">34</span>
          
          <code class="ruby">    OptionParser.new do |parser|</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="129">
          <span class="hits">34</span>
          
          <code class="ruby">      @options.define_options(parser)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="130">
          <span class="hits">34</span>
          
          <code class="ruby">      parser.parse!(args)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="132">
          <span class="hits">34</span>
          
          <code class="ruby">    if @options.file.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">      raise OptionParser::MissingArgument, &quot;Mandatory source file \</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">not provided. Check script help for an overview on the parameters.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="136">
          <span class="hits">33</span>
          
          <code class="ruby">    if @options.money.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">      raise OptionParser::MissingArgument, &quot;Mandatory money value \</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">not provided. Check script help for an overview on the paramaters.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="140">
          <span class="hits">33</span>
          
          <code class="ruby">    save_groups!</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="141">
          <span class="hits">33</span>
          
          <code class="ruby">    @options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">  # Bang function to set the group constraints on a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  # separate hash within @options for easy access</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">  def save_groups!</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="147">
          <span class="hits">33</span>
          
          <code class="ruby">    @options.groups = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">      min_short_term_percent: @options.min_short_term_percent,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">      min_medium_term_percent: @options.min_medium_term_percent,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">      min_long_term_percent: @options.min_long_term_percent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3b456ba687bbb33b0ed70ac458fbf851141cd244">
  <div class="header">
    <h3>lib/output.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># frozen_string_literal: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Namespace for logging specific purposes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">module Output</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # Outputs best selection string for logging purposes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # @param [Array] sel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # @param [Float] val of selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # @param [Float] available money</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.selection_output(sel, val, spent, available)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # TODO: guard the plaussible division by zero</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">    &lt;&lt;~HEREDOC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      Best selection:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      #{sel}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      Best efficiency achieved (in total units of CO2): #{val}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      Money spent over money available: #{spent} / #{available}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    HEREDOC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # Outputs data for best selection of projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # @param [Float] value in CO2 units achieved with selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # @param [Float] spent money in selection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  # @param [Integer] continents</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.new_best_output(value, spent, continents)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">    &lt;&lt;~HEREDOC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      Efficiency of new best selection of projects (in units of CO2): #{value}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      Money spent in new best selection of projects (in money units): #{spent}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      Count of different project locations by continent: #{continents}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    HEREDOC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # Outputs data related to distribution of projects per group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  # @param [Hash] expenditures with money used in for each group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # @param [Float] spent money in selection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.group_representation_output(expenditures, spent)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # TODO: guard the plaussible division by zero</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    &lt;&lt;~HEREDOC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      Representation per group:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">        - Short term value (in money): #{expenditures[:short]}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        In percentage #{((expenditures[:short].to_f / spent) * 100).round(2)}%</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        - Medium term value (in money): #{expenditures[:medium]}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">        In percentage #{((expenditures[:medium].to_f / spent) * 100).round(2)}%</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        - Long term value: (in money) #{expenditures[:long]}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">        In percentage #{((expenditures[:long].to_f / spent) * 100).round(2)}%</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    HEREDOC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
